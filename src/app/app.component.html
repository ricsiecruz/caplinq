<!-- Main Modal -->
<button class="btn btn-primary" (click)="open(content)">Launch Demo Modal</button>

<ng-template #content let-modal>
  <div class="modal-header">
    <div>
      <h4 class="modal-title">Browse</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss(); resetSearch()"></button>
    </div>
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="filterList()"
      class="form-control"
      placeholder="Search supplier"
    />
  </div>
  <div class="modal-body">
    <div *ngFor="let item of filteredList" class="app_suppliers">
      <div (click)="openNewModal(newModalContent, item)" style="display: flex; justify-content: space-between;">
        <div>{{ item.name }}</div>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M13.1717 12.0007L8.22192 7.05093L9.63614 5.63672L16.0001 12.0007L9.63614 18.3646L8.22192 16.9504L13.1717 12.0007Z">
          </path>
        </svg>
      </div>
    </div>
    <div *ngIf="filteredList.length === 0">
      <p>No suppliers found.</p>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.close(); resetSearch()">Close</button>
  </div>
</ng-template>

<!-- New Modal -->
<ng-template #newModalContent let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{ selectedItem?.name }}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss(); resetSearch()"></button>
  </div>
  <div class="modal-body">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (input)="filterProducts()"
      class="form-control"
      placeholder="Search products..."
      style="margin-bottom: 15px;"
    />
    <div *ngIf="filteredProducts.length > 0; else noProducts">
      <div *ngFor="let product of filteredProducts" class="app_suppliers">
        <div (click)="toggleChildProducts(product)">
          <p>{{ product.name }}</p>
        </div>
        <div *ngIf="product.isExpanded">
          <div *ngFor="let childProduct of product.childProducts" class="app_suppliers_products">
            <p>{{ childProduct.name }}</p>
            <p>SKU: {{ childProduct.sku }}</p>
          </div>
        </div>
      </div>
    </div>
    <ng-template #noProducts>
      <p>No products available for this supplier.</p>
    </ng-template>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="goBackToPreviousModal(); resetSelectedProduct()">Back</button>
    <button class="btn btn-secondary" (click)="modal.close(); resetSearch()">Close</button>
  </div>
</ng-template>
